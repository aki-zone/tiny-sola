# 角色扮演语音网页 方案说明

## 1. 目标用户、痛点与用户故事
- **IP 与文学爱好者**：希望沉浸式地与熟悉的角色互动，但传统粉丝圈交流多为文字或同人创作，缺乏即时语音对话体验。
  - *用户故事*：作为哈利·波特的读者，我想用语音和哈利聊聊面对恐惧的经验，从而获得情感共鸣。
- **人文与教育工作者/学生**：课堂讨论或自学时需要可互动的“角色导师”帮助拆解知识点，现有工具多为单向查询或英文资料。
  - *用户故事*：作为伦理学学生，我想让苏格拉底通过追问的方式带我梳理“美德”的概念，辅助写作论文。
- **自我成长与情感陪伴人群**：需要借助虚拟角色获取鼓励、反思与目标拆解，现有播客/文章缺乏个性化反馈。
  - *用户故事*：作为职场新人，我希望向花木兰请教如何兼顾家庭责任与战场协作，从而获得实际行动建议。

## 2. 功能规划与优先级
| 功能 | 说明 | 优先级 | 本次迭代 | 备注 |
| --- | --- | --- | --- | --- |
| 角色搜索与筛选 | 关键字检索 + 角色档案展示 | High | ✅ | 支持预设三位角色，可扩展更多 | 
| 语音对话流程 | 录音、ASR、LLM 回复、TTS 播放 | High | ✅ | 支持多轮上下文，历史裁剪至 8 轮 |
| 角色技能面板 | 角色速写, 代表性语句, 导师建议, 反思提问 | High | ✅ | 技能调用可复用对话上下文 |
| 技能输出归档 | 将技能结果保存成列表，支持清空 | Medium | ✅ | 后续可拓展导出/收藏 |
| 健康检测面板 | 检查 ffmpeg / Piper / Ollama 状态 | Medium | ✅ | 方便部署时快速排障 |
| 角色素材管理 | 后台维护角色设定、提示词模板 | Medium | ✅ | 通过后端配置集中管理 |
| 会话持久化 | 断线后可恢复会话 | Low | ⏳ | 未来可引入账号体系/数据库 |
| 角色自定义 | 用户自定义新角色 | Low | ⏳ | 需提供配置 UI 与安全审核 |

## 3. LLM 模型选型说明
- **候选模型对比**：
  1. *OpenAI GPT-4o* —— 语言质量高，但需外网和按量计费，不利于本地化部署。
  2. *智谱 GLM-4/通义千问* —— 中文能力强，云端接口成熟，但存在数据出境与成本考量。
  3. *Ollama 本地模型（llama3:8b, qwen2:7b 等）* —— 可离线运行，易于在同一机房部署，并可根据算力随时切换模型。
- **最终方案**：选择在 Ollama 上运行 `llama3:8b` 作为默认模型，原因：
  - 单卡即可流畅运行，响应速度满足 Demo 场景；
  - llama3 具备良好的多语种与角色扮演能力，能较好地保持语调；
  - 结合本地部署，避免语音数据外发，利于教研/企业场景。
- **后续优化**：在需要更强中文表达或特定领域知识时，可将 `OLLAMA_MODEL` 切换为 `qwen2:7b` 或更大参数模型；同时预留了 API 设计，未来可以添加云端模型适配层。

## 4. 角色技能设计
已上线的技能均复用 LLM + 角色设定模板，不依赖额外 Agent 编排：
1. **角色速写（world_briefing）**：以第一人称输出 4-5 句“自我介绍”，快速让用户理解角色背景、当下心态与故事节点。
2. **代表性语句（signature_quote）**：生成一句该角色的金句，并结合当前上下文解释启发意义，强化人物价值观。
3. **导师建议（mentor_plan）**：针对用户输入的问题输出三步行动策略，强调可执行步骤和鼓励性语气。
4. **反思提问（challenge_question）**：给出开放式问题，引导用户换位思考，同时可附上一句点拨。

技能输出会被收藏在“技能输出”面板，方便对照语音对话记录，达到“听得见 + 看得见”的双重体验。

## 实现摘要
- 后端新增角色/技能配置、历史裁剪、多能力接口 (`/roles`, `/roles/{id}/skills/{skill}`)，并让 `/talk` 支持角色和上下文信息。
- 前端提供角色搜索、详情与技能触发界面，整合语音流程、技能归档与日志观测，全部操作保持中文提示。
- 文档、代码和 UI 均围绕“既可语音聊天又可技能赋能”的目标设计，支持后续扩展更多角色与模型。
